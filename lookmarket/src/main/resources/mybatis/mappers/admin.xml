<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.admin">
  	<resultMap id="businessResult" type="businessVO">
		<result property="m_id" column="m_id" />
		<result property="bm_name" column="bm_name" />
		<result property="bm_reg_num" column="bm_reg_num" />
		<result property="bm_type" column="bm_type" />
		<result property="bm_status" column="bm_status" />
	</resultMap>
	<resultMap id="orderMap" type="orderVO">
		<result property="oId" column="o_id"/>
		<result property="mId" column="m_id"/>
		<result property="oiDeliveryPrice" column="oi_delivery_price"/>
		<result property="oiTotalGoodsPrice" column="oi_total_goods_price"/>
		<result property="oiSalePrice" column="oi_sale_price"/>
		<result property="oiName" column="oi_name"/>
		<result property="oiReceiverName" column="oi_receiver_name"/>
		<result property="oiReceiverPhone" column="oi_receiver_phone"/>
		<result property="oiDate" column="oi_date"/>
		<result property="oiDeliveryAddress" column="oi_delivery_address"/>
		<result property="oi_deli_namuji_address" column="oi_deli_namuji_address"/>
		<result property="oiDeliveryMessage" column="oi_deli_numuji_address"/>
	</resultMap>
	<resultMap type="orderItemVO" id="ItemMap">
	<result property="oNum" column="o_num"/>
	<result property="oId" column="o_id"/>
	<result property="otGId" column="ot_g_id"/>
	<result property="otGoodsPrice" column="ot_goods_price"/>
	<result property="otSalePrice" column="ot_sale_price"/>
	<result property="otGoodsName" column="ot_goods_name"/>
	<result property="otGoodsQty" column="ot_goods_qty"/>
	</resultMap>
	<resultMap type="deliveryVO" id="deliMap">
	<result property="d_id" column="d_id"/>
	<result property="o_id" column="o_id"/>
	<result property="d_status" column="d_status"/>
	<result property="d_company" column="d_company"/>
	<result property="d_transport_num" column="d_transport_num"/>
	<result property="d_shipped_date" column="d_shipped_date"/>
	<result property="d_delivery_date" column="d_delivery_date"/>
	<result property="d_m_id" column="d_m_id"/>
	</resultMap>
	
	<!-- 사업자 승인 -->
	<update id="approve" parameterType="String">
		update business_member set bm_status = 2 where m_id = #{m_id}
	</update>

	<!-- 사업자 승인 거부-->
	<update id="reject" parameterType="String">
		update business_member set bm_status = 3 where m_id = #{m_id}
	</update>
	
	<!-- 사업자 승인 되돌리기-->
	<update id="revers" parameterType="String">
		update business_member set bm_status = 1 where m_id = #{m_id}
	</update>
  	
  	<select id="getMemberList" resultType="memberVO">
  		select * from member where m_role = 1 or m_role = 2
  	</select>
  	
  	<select id="allboardList" resultType="blackBoardVO">
  		select * from blackboard
  	</select>
  	
	  <!-- 주문 목록 페이징 -->
	<select id="selectOrderPage" resultMap="orderMap">
	    SELECT o_id, m_id, oi_delivery_price, oi_total_goods_price, oi_sale_price,
	           oi_name, oi_receiver_name, oi_receiver_phone, oi_date,
	           oi_delivery_address, oi_deli_namuji_address, oi_delivery_message
	    FROM order_info
	    ORDER BY oi_date DESC
	    LIMIT #{limit} OFFSET #{offset}
	</select>
	
	<!-- 주문 상품 -->
	<select id="selectOrderItemsByOrderId" resultMap="ItemMap">
	    SELECT o_num, o_id, ot_g_id, ot_goods_price, ot_sale_price,
	           ot_goods_name, ot_goods_qty
	    FROM order_item
	    WHERE o_id = #{o_id}
	</select>
	
	<!-- 배송 정보 -->
	<select id="selectDeliveryByOrderId" resultMap="deliMap">
	    SELECT d_id, o_id, d_company, d_tracking_num, d_status, d_created_at
	    FROM delivery
	    WHERE o_id = #{o_id}
	</select>
	
	<!-- 전체 주문 수 -->
	<select id="selectOrderCount" resultType="int">
	    SELECT COUNT(*) FROM order_info
	</select>
	<resultMap id="OrderDTO" type="com.lookmarket.order.vo.OrderDTO">
	  <association property="order" javaType="com.lookmarket.order.vo.OrderVO">
	    <id property="oId" column="o_id"/>
	    <result property="oiName" column="oi_name"/>
	    <result property="oiDeliveryAddress" column="oi_delivery_address"/>
	    <result property="oi_deli_namuji_address" column="oi_deli_namuji_address"/>
	    <result property="oiSalePrice" column="oi_sale_price"/>
	  </association>
	
	  <association property="delivery" javaType="com.lookmarket.order.vo.DeliveryVO">
	    <result property="d_company" column="d_company"/>
	  </association>
	
	  <collection property="orderItems" ofType="com.lookmarket.order.vo.OrderItemVO">
	    <result property="otGoodsName" column="ot_goods_name"/>
	    <result property="otGoodsPrice" column="ot_goods_price"/>
	  </collection>
	</resultMap>
		
	<select id="joinedOrderData" resultMap="OrderDTO">
	  SELECT 
	    oi.o_id,
	    oi.oi_name,
	    oi.oi_sale_price,
	    ot.ot_goods_name,
	    ot.ot_goods_price,
	    d.d_company,
	    oi.oi_delivery_address,
	    oi.oi_deli_namuji_address
	  FROM order_info oi
	  JOIN order_item ot ON oi.o_id = ot.o_id
	  JOIN delivery d ON oi.o_id = d.o_id
	  ORDER BY oi.o_id DESC
	</select>
	
</mapper>




