<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.goods">

    <!-- resultMap 정의 -->
    <resultMap id="goodsResultMap" type="GoodsVO">
        <result property="g_id" column="g_id"/>
        <result property="g_category" column="g_category"/>
        <result property="g_name" column="g_name"/>
        <result property="g_brand" column="g_brand"/>
        <result property="g_discription" column="g_discription"/>
        <result property="g_qty" column="g_qty"/>
        <result property="g_price" column="g_price"/>
        <result property="g_sale_price" column="g_sale_price"/>
        <result property="g_credate" column="g_credate"/>
        <result property="g_manufactured_date" column="g_manufactured_date"/>
        <result property="g_expiration_date" column="g_expiration_date"/>
        <result property="g_delivery_price" column="g_delivery_price"/>
        <result property="g_delivery_date" column="g_delivery_date"/>
        <result property="g_status" column="g_status"/>
        <result property="g_stock" column="g_stock"/>
        <result property="i_filename" column="i_filename"/>
        <result property="cre_m_id" column="cre_m_id"/>
    </resultMap>
    


    <!-- 전체 상품 조회 -->
    <select id="selectAllGoodsList" resultMap="goodsResultMap">
        SELECT * FROM goods ORDER BY g_id DESC
    </select>
    <select id="getFreshGoods" resultMap="goodsResultMap">
        SELECT * FROM goods where g_category = #{g_category} ORDER BY g_id DESC
    </select>
    <select id="getProcessed" resultMap="goodsResultMap">
        SELECT * FROM goods where g_category = #{g_category} ORDER BY g_id DESC
    </select>
    <select id="getLiving" resultMap="goodsResultMap">
        SELECT * FROM goods where g_category = #{g_category} ORDER BY g_id DESC
    </select>
    <select id="getFashion" resultMap="goodsResultMap">
        SELECT * FROM goods where g_category = #{g_category} ORDER BY g_id DESC
    </select>
    <select id="getLocal" resultMap="goodsResultMap">
        SELECT * FROM goods where g_category = #{category} ORDER BY g_id DESC
    </select>
    <select id="selectAllMyGoodsList" parameterType="map" resultType="GoodsVO">
	SELECT g_id, g_category, g_name, g_brand, g_price, g_stock, g_status FROM goods WHERE cre_m_id = #{mId}
  <if test="category != null">
  AND g_category = #{category}
</if>
  ORDER BY g_id DESC
    </select>

    <!-- 상세 조회 -->
    <select id="selectGoodsDetail" parameterType="int" resultMap="goodsResultMap">
        SELECT * FROM goods WHERE g_id = #{g_id}
    </select>
    <select id="myGoodsList" resultMap="goodsResultMap" parameterType="String">
    	select * from goods where cre_m_id = #{cre_m_id}
    </select>
    
    <!-- 상품 등록 -->
    <insert id="insertGoods" parameterType="GoodsVO" useGeneratedKeys="true" keyProperty="g_id" keyColumn="g_id">
        INSERT INTO goods (
            g_category, g_name, g_brand, g_discription, g_price, g_manufactured_date, g_expiration_date, g_delivery_price, g_stock, i_filename, cre_m_id)
            values(
	#{g_category}, #{g_name}, #{g_brand}, #{g_discription}, #{g_price}, #{g_manufactured_date}, #{g_expiration_date}, #{g_delivery_price}, #{g_stock}, #{i_filename} ,#{cre_m_id})     
    </insert>
    
    <!--  상품 수정 -->
    <update id="updateGoods" parameterType="GoodsVO">
	  UPDATE goods SET
	    g_category = #{g_category},
	    g_name = #{g_name},
	    g_brand = #{g_brand},
	    g_discription = #{g_discription},
	    g_price = #{g_price},
	    g_manufactured_date = #{g_manufactured_date},
	    g_expiration_date = #{g_expiration_date},
	    g_delivery_price = #{g_delivery_price},
	    g_status = #{g_status},
	    g_stock = #{g_stock},
	    i_filename = #{i_filename}     <!-- ✅ 이 줄 추가 -->
	  WHERE g_id = #{g_id}
	</update>

    <!-- 상품 삭제 -->
    <delete id="deleteGoods" parameterType="int">
        DELETE FROM goods WHERE g_id = #{g_id}
    </delete>
    
    
	<!-- 상품 이미지 삭제 -->
	<delete id="deleteGoodsImages" parameterType="int">
    	DELETE FROM goods_image WHERE g_id = #{g_id}
	</delete>
    
    <resultMap id="imageResult" type="imageFileVO">
    	<result property="i_id" column="i_id"/>
    	<result property="g_id" column="g_id"/>
    	<result property="i_filename" column="i_filename"/>
    	<result property="i_filetype" column="i_filetype"/>
    	<result property="i_credate" column="i_credate"/>
    </resultMap>
    
    <insert id="insertGoodsImageFile" parameterType="imageFileVO">
    	insert into goods_image(
    		g_id, i_filename, i_filetype) values(#{g_id}, #{i_filename}, #{i_filetype})
    </insert>
    
    <select id="selectMainimagefile" parameterType="int" resultType="imageFileVO">
    	select * from goods_image where g_id=#{g_id}
    </select>
    


</mapper>

