<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lookmarket.event.dao.EventDAO">
	<select id="selectPromotionPostList" resultType="com.lookmarket.event.vo.EventPostVO">
	    SELECT
		    post_id AS postId,
		    promo_title AS promoTitle,
		    promo_content AS promoContent,
		    promo_banner_img AS promoBannerImg,
		    promo_start_date AS promoStartDate,
		    promo_end_date AS promoEndDate,
		    promo_created_at AS promoCreatedAt,
		    promo_status AS promoStatus
		FROM promotion_post
		ORDER BY promo_created_at DESC

	</select>

	<select id="selectPromotionPostById" parameterType="int" resultType="com.lookmarket.event.vo.EventPostVO">
	    SELECT
	        post_id AS postId,
	        promo_title AS promoTitle,
	        promo_content AS promoContent,
	        promo_banner_img AS promoBannerImg,
	        promo_start_date AS promoStartDate,
	        promo_end_date AS promoEndDate,
	        promo_created_at AS promoCreatedAt,
	        promo_status AS promoStatus
	    FROM promotion_post
	    WHERE post_id = #{postId}
	</select>

    <insert id="insertPromotionPost" parameterType="com.lookmarket.event.vo.EventPostVO">
        INSERT INTO promotion_post (
            promo_title,
            promo_content,
            promo_banner_img,
            promo_start_date,
            promo_end_date,
            promo_status
        ) VALUES (
            #{promoTitle},
            #{promoContent},
            #{promoBannerImg},
            #{promoStartDate},
            #{promoEndDate},
            #{promoStatus}
        )
    </insert>
	<update id="updatePromotionPost" parameterType="com.lookmarket.event.vo.EventPostVO">
	    UPDATE promotion_post
	    SET
	        promo_title = #{promoTitle},
	        promo_content = #{promoContent},
	        promo_banner_img = #{promoBannerImg},
	        promo_start_date = #{promoStartDate},
	        promo_end_date = #{promoEndDate},
	        promo_status = #{promoStatus}
	    WHERE post_id = #{postId}
	</update>
	
	<delete id="deletePromotionPost" parameterType="int">
	    DELETE FROM promotion_post WHERE post_id = #{postId}
	</delete>
	
	
	    <!-- 쿠폰 VO 매핑 -->
    <resultMap id="couponResultMap" type="com.lookmarket.event.vo.CouponVO">
        <id property="promoId" column="promo_id"/>
        <result property="promoCode" column="promo_code"/>
        <result property="promoDiscountType" column="promo_discount_type"/>
        <result property="promoDiscountValue" column="promo_discount_value"/>
        <result property="promoMaxDiscount" column="promo_max_discount"/>
        <result property="promoMinPurchase" column="promo_min_purchase"/>
        <result property="promoStartDate" column="promo_start_date"/>
        <result property="promoEndDate" column="promo_end_date"/>
        <result property="promoCouponActive" column="promo_coupon_active"/>
        <result property="mId" column="m_id"/>
        <result property="promoUsedDate" column="promo_used_date"/>
        <result property="postId" column="post_id"/>
    </resultMap>

    <!-- 쿠폰 목록 조회 (전체 또는 특정 postId) -->
    <select id="selectCouponListByPostId" parameterType="int" resultMap="couponResultMap">
        SELECT * FROM promotion_coupon WHERE post_id = #{postId}
        ORDER BY promo_start_date DESC
    </select>

    <!-- 쿠폰 단건 조회 -->
    <select id="selectCouponById" parameterType="int" resultMap="couponResultMap">
        SELECT * FROM promotion_coupon WHERE promo_id = #{promoId}
    </select>

    <!-- 쿠폰 등록 -->
    <insert id="insertCoupon" parameterType="com.lookmarket.event.vo.CouponVO">
        INSERT INTO promotion_coupon (
            promo_code,
            promo_discount_type,
            promo_discount_value,
            promo_max_discount,
            promo_min_purchase,
            promo_start_date,
            promo_end_date,
            promo_coupon_active,
            m_id,
            promo_used_date,
            post_id
        ) VALUES (
            #{promoCode},
            #{promoDiscountType},
            #{promoDiscountValue},
            #{promoMaxDiscount},
            #{promoMinPurchase},
            #{promoStartDate},
            #{promoEndDate},
            #{promoCouponActive},
            #{mId},
            #{promoUsedDate},
            #{postId}
        )
    </insert>

    <!-- 쿠폰 수정 -->
    <update id="updateCoupon" parameterType="com.lookmarket.event.vo.CouponVO">
        UPDATE promotion_coupon
        SET
            promo_code = #{promoCode},
            promo_discount_type = #{promoDiscountType},
            promo_discount_value = #{promoDiscountValue},
            promo_max_discount = #{promoMaxDiscount},
            promo_min_purchase = #{promoMinPurchase},
            promo_start_date = #{promoStartDate},
            promo_end_date = #{promoEndDate},
            promo_coupon_active = #{promoCouponActive},
            m_id = #{mId},
            promo_used_date = #{promoUsedDate},
            post_id = #{postId}
        WHERE promo_id = #{promoId}
    </update>

    <!-- 쿠폰 삭제 -->
    <delete id="deleteCoupon" parameterType="int">
        DELETE FROM promotion_coupon
        WHERE promo_id = #{promoId}
    </delete>
	
</mapper>
