<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lookmarket.event.dao.EventDAO">
	<select id="selectPromotionPostList" resultType="com.lookmarket.event.vo.EventPostVO">
	    SELECT
		    post_id AS postId,
		    promo_title AS promoTitle,
		    promo_content AS promoContent,
		    promo_banner_img AS promoBannerImg,
		    promo_start_date AS promoStartDate,
		    promo_end_date AS promoEndDate,
		    promo_created_at AS promoCreatedAt,
		    promo_status AS promoStatus
		FROM promotion_post
		ORDER BY promo_created_at DESC

	</select>

	<select id="selectPromotionPostById" parameterType="int" resultType="com.lookmarket.event.vo.EventPostVO">
	    SELECT
	        post_id AS postId,
	        promo_title AS promoTitle,
	        promo_content AS promoContent,
	        promo_banner_img AS promoBannerImg,
	        promo_start_date AS promoStartDate,
	        promo_end_date AS promoEndDate,
	        promo_created_at AS promoCreatedAt,
	        promo_status AS promoStatus
	    FROM promotion_post
	    WHERE post_id = #{postId}
	</select>

    <insert id="insertPromotionPost" parameterType="com.lookmarket.event.vo.EventPostVO">
        INSERT INTO promotion_post (
            promo_title,
            promo_content,
            promo_banner_img,
            promo_start_date,
            promo_end_date,
            promo_status
        ) VALUES (
            #{promoTitle},
            #{promoContent},
            #{promoBannerImg},
            #{promoStartDate},
            #{promoEndDate},
            #{promoStatus}
        )
    </insert>
	<update id="updatePromotionPost" parameterType="com.lookmarket.event.vo.EventPostVO">
	    UPDATE promotion_post
	    SET
	        promo_title = #{promoTitle},
	        promo_content = #{promoContent},
	        promo_banner_img = #{promoBannerImg},
	        promo_start_date = #{promoStartDate},
	        promo_end_date = #{promoEndDate},
	        promo_status = #{promoStatus}
	    WHERE post_id = #{postId}
	</update>
	
	<delete id="deletePromotionPost" parameterType="int">
	    DELETE FROM promotion_post WHERE post_id = #{postId}
	</delete>
	<insert parameterType="map" id="insertCoupon">
		INSERT INTO promotion_coupon(
			promo_code, 
			promo_discount_type, 
			promo_discount_value, 
			promo_max_discount, 
			promo_min_purchase, 
			promo_start_date, 
			promo_end_date, 
			promo_coupon_active, 
			m_id, 
			promo_used_date, 
			post_id)
		VALUES(
			#{promo_code}, 
			#{promo_discount_type}, 
			#{promo_discount_value}, 
			#{promo_max_discount}, 
			#{promo_min_purchase}, 
			#{promo_start_date}, 
			#{promo_end_date}, 
			#{promo_coupon_active}, 
			#{m_id}, 
			#{promo_used_date}, 
			#{post_id}) 
	</insert>
	
	<select parameterType="int" id="selectCouponById" resultType="map">
		SELECT * FROM promotion_coupon 
		WHERE promo_id = #{promoId} 
	</select>
	
	<select id="selectCouponList" resultType="map">
		SELECT * FROM promotion_coupon 
		ORDER BY promo_start_date DESC 
	</select>
	
	<update parameterType="map" id="updateCoupon">
		UPDATE promotion_coupon 
		SET 
			promo_code = #{promo_code},
			promo_discount_type = #{promo_discount_type},
			promo_discount_value = #{promo_discount_value},
			promo_max_discount = #{promo_max_discount},
			promo_min_purchase = #{promo_min_purchase},
			promo_start_date = #{promo_start_date},
			promo_end_date = #{promo_end_date},
			promo_coupon_active = #{promo_coupon_active},
			m_id = #{m_id},
			promo_used_date = #{promo_used_date},
			post_id = #{post_id}
		WHERE 
			promo_id = #{promo_id} 
	</update>
	
	<delete parameterType="int" id="deleteCoupon">
		DELETE FROM promotion_coupon 
		WHERE promo_id = #{promoId} 
	</delete>
	
	<!-- 쿠폰-프로모션 연결 -->
</mapper>
