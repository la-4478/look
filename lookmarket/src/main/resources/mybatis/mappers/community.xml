<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.community">
	<resultMap id="blackBoardResult" type="BlackBoardVO">
		<result property="b_id" column="b_id" />
		<result property="m_id" column="m_id" />
		<result property="b_title" column="b_title" />
		<result property="b_content" column="b_content" />
		<result property="b_date" column="b_date" />
		<result property="b_hit" column="b_hit" />
	</resultMap>
	<resultMap id="reviewResult" type="ReviewVO">
		<result property="r_id" column="r_id" />
		<result property="m_id" column="m_id" />
		<result property="r_title" column="r_title" />
		<result property="g_name" column="g_name" />
		<result property="r_star" column="r_star" />
		<result property="r_content" column="r_content" />
		<result property="r_filename" column="r_filename" />
		<result property="r_filetype" column="r_filetype" />
		<result property="r_secret" column="r_secret" />
		<result property="r_date" column="r_date" />
		<result property="r_hit" column="r_hit" />
	</resultMap>
	
	<select id="blackBoardList" resultMap="blackBoardResult">
		<![CDATA[
			SELECT * FROM blackboard
		]]>
	</select>
	
	<select id="blackBoardDetail" parameterType="int" resultMap="blackBoardResult">
	    <![CDATA[
	    SELECT * FROM blackboard WHERE b_id = #{b_id}
	    ]]>
	</select>

	<select id="communityList" resultMap="reviewResult">
		<![CDATA[
			SELECT * FROM review
		]]>
	</select>
	
	<select id="communityDetail" parameterType="int" resultMap="reviewResult">
		<![CDATA[
			SELECT * FROM review WHERE r_id=#{r_id}
		]]>
	</select>
	
	<!-- 조회수 증가 -->
	<update id="upHit" parameterType="int">
		<![CDATA[
			UPDATE review
			SET
			r_hit = r_hit + 1
			WHERE r_id = #{r_id}
		]]>
	</update>
	
	<update id="upBlackHit" parameterType="String">
	    UPDATE blackboard
	    SET b_hit = b_hit + 1
	    WHERE b_id = #{b_id}
	</update>
	
	<insert id="insertReview" parameterType="com.lookmarket.community.vo.ReviewVO">
    INSERT INTO review (
        m_id,
        r_title,
        g_name,
        r_star,
        r_content,
        r_filename,
        r_filetype,
        r_secret,
        r_date,
        r_hit
    ) VALUES (
        #{m_id},
        #{r_title},
        #{g_name},
        #{r_star},
        #{r_content},
        #{r_filename},
        #{r_filetype},
        #{r_secret},
        NOW(),
        #{r_hit}
    )
	</insert>
	<update id="updateReview" parameterType="com.lookmarket.community.vo.ReviewVO">
   		UPDATE review
    	SET
        	r_title = #{r_title},
        	g_name = #{g_name},
        	r_star = #{r_star},
        	r_content = #{r_content},
        	r_secret = #{r_secret},
        	r_filename = COALESCE(#{r_filename}, ''),
        	r_filetype = COALESCE(#{r_filetype}, '')
    	WHERE r_id = #{r_id}
	</update>
	
	<update id="updateBlackBoard" parameterType="com.lookmarket.community.vo.BlackBoardVO">
	    UPDATE blackboard
	    SET
	        b_title = #{b_title},
	        b_content = #{b_content}
	    WHERE b_id = #{b_id}
	</update>
	
	<delete id="deleteReview" parameterType="int">
    	DELETE FROM review WHERE r_id = #{r_id}
	</delete>
	
	<!-- mapper/blackboard-mapper.xml -->
	<insert id="insertBlackBoard" parameterType="com.lookmarket.community.vo.BlackBoardVO">
    	INSERT INTO blackboard (m_id, b_title, b_content, b_date, b_hit)
    	VALUES (#{m_id}, #{b_title}, #{b_content}, NOW(), #{b_hit})
	</insert>
	<delete id="deleteBlackBoard" parameterType="int">
	    DELETE FROM blackboard
	    WHERE b_id = #{b_id}
	</delete>

</mapper>