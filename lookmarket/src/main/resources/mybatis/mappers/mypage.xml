<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.mypage">
	<resultMap id="myPageResult" type="MyPageVO">
		<result property="m_id" column="m_id" />
		<result property="m_pw" column="m_pw" />
		<result property="m_name" column="m_name" />
		<result property="m_gender" column="m_gender" />
		<result property="m_birth" column="m_birth" />
		<result property="m_phone_telecom" column="m_phone_telecom" />
		<result property="m_phone" column="m_phone" />
		<result property="m_phone_yn" column="m_phone_yn" />
		<result property="m_email" column="m_email" />
		<result property="m_email_id" column="m_email_id" />
		<result property="m_email_domain" column="m_email_domain" />
		<result property="m_email_yn" column="m_email_yn" />
		<result property="m_zipcode" column="m_zipcode" />
		<result property="m_road_address" column="m_road_address" />
		<result property="m_jibun_address" column="m_jibun_address" />
		<result property="m_namuji_address" column="m_namuji_address" />
		<result property="m_level" column="m_level" />
		<result property="m_role" column="m_role" />
		<result property="m_joindate" column="m_joindate" />
		<result property="m_outdate" column="m_outdate" />
	</resultMap>
	
	<!-- 주문 정보 resultMap -->
    <resultMap id="orderResultMap" type="com.lookmarket.order.vo.OrderVO">
        <result property="oId" column="o_id"/>
        <result property="mId" column="m_id"/>
        <result property="oiDeliveryPrice" column="oi_delivery_price"/>
        <result property="oiTotalGoodsPrice" column="oi_total_goods_price"/>
        <result property="oiSalePrice" column="oi_sale_price"/>
        <result property="oiName" column="oi_name"/>
        <result property="oiReceiverName" column="oi_receiver_name"/>
        <result property="oiReceiverPhone" column="oi_receiver_phone"/>
        <result property="oiDate" column="oi_date"/>
        <result property="oiDeliveryAddress" column="oi_delivery_address"/>
        <result property="oi_deli_namuji_address" column="oi_deli_namuji_address"/>
        <result property="oiDeliveryMessage" column="oi_delivery_message"/>
    </resultMap>

    <!-- 주문 아이템 resultMap -->
    <resultMap id="orderItemResultMap" type="com.lookmarket.order.vo.OrderItemVO">
        <result property="oNum" column="o_num"/>
        <result property="oId" column="o_id"/>
        <result property="otGId" column="ot_g_id"/>
        <result property="otGoodsPrice" column="ot_goods_price"/>
        <result property="otSalePrice" column="ot_sale_price"/>
        <result property="otGoodsName" column="ot_goods_name"/>
        <result property="otGoodsQty" column="ot_goods_qty"/>
    </resultMap>
	
	<select id="getMyPageInfo" parameterType="String" resultType="myPageVO">
		<![CDATA[
			SELECT * FROM member
			WHERE m_id = #{current_id}
		]]>
	</select>
	
	<update id="updateMyInfo" parameterType="myPageVO">
		<![CDATA[
			UPDATE member
			SET
			m_pw = #{m_pw},
			m_phone = #{m_phone},
			m_phone_yn = #{m_phone_yn},
			m_email = #{m_email},
			m_email_yn = #{m_email_yn},
			m_gender = #{m_gender},
			m_zipcode = #{m_zipcode},
			m_road_address = #{m_road_address},
			m_jibun_address = #{m_jibun_address},
			m_namuji_address = #{m_namuji_address}
			WHERE m_id = #{m_id}
		]]>
	</update>
	
	<update id="deleteMyInfo" parameterType="String">
		<![CDATA[
			UPDATE member
			SET m_outdate = CURDATE() WHERE m_id = #{m_id}
		]]>
	</update>
	
	<select id="selectMyCommunityList" parameterType="String" resultType="com.lookmarket.community.vo.ReviewVO">
    	<![CDATA[
        	SELECT r_id, m_id, r_title, g_name, r_star, r_content,
               	r_filename, r_filetype, r_secret, r_date, r_hit
        	FROM review
        	WHERE m_id = #{m_id}
        	ORDER BY r_date DESC
    	]]>
	</select>
	
		<!-- 회원 주문목록 조회 -->
    <select id="getOrdersByMemberId" parameterType="String" resultType="OrderVO">
    <![CDATA[
        SELECT 
            o_id AS oId,
            m_id AS mId,
            oi_delivery_price AS oiDeliveryPrice,
            oi_total_goods_price AS oiTotalGoodsPrice,
            oi_sale_price AS oiSalePrice,
            oi_name AS oiName,
            oi_receiver_name AS oiReceiverName,
            oi_receiver_phone AS oiReceiverPhone,
            oi_delivery_address AS oiDeliveryAddress,
            oi_deli_namuji_address AS oi_deli_namuji_address,
            oi_delivery_message AS oiDeliveryMessage,
            oi_date AS oiDate
        FROM order_info
        WHERE m_id = #{m_id}
        ORDER BY oi_date DESC
    ]]>
	</select>
    
    <!-- 주문 상세 조회 -->
    <select id="getOrderById" parameterType="int" resultType="OrderVO">
    <![CDATA[
        SELECT 
            o_id AS oId,
            m_id AS mId,
            oi_delivery_price AS oiDeliveryPrice,
            oi_total_goods_price AS oiTotalGoodsPrice,
            oi_sale_price AS oiSalePrice,
            oi_name AS oiName,
            oi_receiver_name AS oiReceiverName,
            oi_receiver_phone AS oiReceiverPhone,
            oi_delivery_address AS oiDeliveryAddress,
            oi_deli_namuji_address AS oi_deli_namuji_address,
            oi_delivery_message AS oiDeliveryMessage,
            oi_date AS oiDate
        FROM order_info
        WHERE o_id = #{oId}
    ]]>
	</select>
    
    <!-- 주문 상품목록 조회 -->
    <select id="getOrderItemsByOrderId" parameterType="int" resultType="OrderItemVO">
    <![CDATA[
        SELECT 
            o_num AS oNum,
            o_id AS oId,
            ot_g_id AS otGId,
            ot_goods_price AS otGoodsPrice,
            ot_sale_price AS otSalePrice,
            ot_goods_name AS otGoodsName,
            ot_goods_qty AS otGoodsQty
        FROM order_item
        WHERE o_id = #{oId}
    ]]>
	</select>

	<!-- 회원별 배송내역 조회 -->
	<select id="selectDeliveryListByMember" 
	        parameterType="string" 
	        resultType="com.lookmarket.order.vo.DeliveryVO">
	    SELECT 
	        d_id, o_id, d_status, d_company, d_transport_num,
	        d_shipped_date, d_delivery_date, d_m_id
	    FROM delivery
	    WHERE d_m_id = #{d_m_id}
	    ORDER BY d_id DESC
	</select>

	<!-- 찜목록 조회 -->
    <select id="getMyWishList" parameterType="string" resultType="com.lookmarket.wishlist.vo.WishListVO">
        SELECT 
            w.w_id AS wId,
            w.g_id AS gId,
            w.m_id AS mId,
            g.g_name AS gName,
            g.g_price AS gPrice,
            w.g_image AS gImage
        FROM wishlist w
        JOIN goods g ON w.g_id = g.g_id
        WHERE w.m_id = #{m_id}
        ORDER BY w.w_id DESC
    </select>
    <update id="cencelDelivery" parameterType="int">
    	<![CDATA[
    		update delivery set
    		d_status = 4 where o_id = #{oId}
    	]]>
    </update>
    
</mapper>